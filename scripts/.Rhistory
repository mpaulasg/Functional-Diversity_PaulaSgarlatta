scale_x_continuous( limits = c(2002, 2018), breaks = seq(from=2002, to=2018, by=4)  ) +
#scale_y_continuous( limits = c(4.5,6.5), breaks = seq(from=4.5, to=6.5, by=0.5)  ) +
scale_color_manual(values=year_colors, name="Habitat", breaks = c("kelp", "no_kelp"), labels=c("Kelp", "No kelp")) +
scale_fill_manual(values=year_colors, name="Habitat", breaks = c("kelp", "no_kelp"), labels=c("Kelp", "No kelp")) +
facet_wrap(.~q, scales="free")+
labs(x="", y="Hill Numbers FD") +
theme(panel.background=element_rect(fill="white"), panel.grid.minor = element_blank(), axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),axis.line = element_line(size = 1, colour = "black"),
axis.text = element_text(size = (14),colour = "black"), axis.title = element_text(size= (16)),
legend.title = element_text(size=14), legend.text = element_text(size=14),
legend.background = element_blank(), legend.key=element_blank())
plot_tempo_func_Hill_c
figure1c_Hill <- ( plot_spatial_func_Hill / plot_tempo_func_Hill_c )
## merging all plot into a single figure and saving as png ####
figure1c_Hill <- ( plot_spatial_func_Hill / plot_tempo_func_Hill_c )
## merging all plot into a single figure and saving as png ####
figure1c_Hill <- ( plot_spatial_func_Hill / plot_tempo_func_Hill_c )
plot_tempo_func_Hill_c
plot_spatial_func_Hill
## merging all plot into a single figure and saving as png ####
figure1c_Hill <- ( plot_spatial_func_Hill / plot_tempo_func_Hill_c )
## merging all plot into a single figure and saving as png ####
figure1c_Hill <- ( plot_spatial_func_Hill + plot_tempo_func_Hill_c )
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(dplyr)
library(xgboost)
library(rfishprod)
#Load data
for_K <- read.csv(here::here("from_paula", "fish_for_K.csv"),
header = T)
View(for_K)
############################################################################################################
##
## Script for plotting temporal homogenisation within each habitat
##
## Code by Paula Sgarlatta, Sebastien Villeger and Camille Magneville
##
###########################################################################################################
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
load(here::here("outputs/", "FD_beta_nokelp_Hill.RData") )
load(here::here("outputs/", "TD_beta_nokelp_Hill.RData") )
load(here::here("outputs/", "FD_beta_kelp_Hill.RData") )
load(here::here("outputs/", "TD_beta_kelp_Hill.RData") )
load(here::here("outputs/", "FD_beta_spatial_Hill.RData") )
load(here::here("outputs/", "TD_beta_spatial_Hill.RData") )
TD_beta_kelp$Habitat <- "Kelp"
TD_beta_nokelp$Habitat <- "No_kelp"
TD_beta_kelp$Year <- ifelse(TD_beta_kelp$Year1 == TD_beta_kelp$Year2,
TD_beta_kelp$Year1, NA)
TD_beta_nokelp$Year <- ifelse(TD_beta_nokelp$Year1 == TD_beta_nokelp$Year2,
TD_beta_nokelp$Year1, NA)
TD_beta_kelp_done <- na.omit(TD_beta_kelp)%>%
select(Year, q0, q1, q2, Habitat)
TD_beta_nokelp_done <- na.omit(TD_beta_nokelp) %>%
select(Year, q0, q1, q2, Habitat)
TD_beta_spatial$Habitat <- ifelse(TD_beta_spatial$Habitat1 == TD_beta_spatial$Habitat2,
TD_beta_spatial$Habitat1, NA)
TD_beta_spatial$Year <- "2013"
TD_beta_spatial_done <- na.omit(TD_beta_spatial)%>%
select(Year, q0, q1, q2, Habitat)
TD_beta_toplot <- rbind(TD_beta_kelp_done,
TD_beta_nokelp_done, TD_beta_spatial_done )
taxo_diss_Hill <- TD_beta_toplot %>%
select(Year, Habitat, q1) %>%
group_by(Year, Habitat) %>%
summarise( n = n(),
q1_mean = mean(q1),
q1_sd = sd(q1)
) %>%
mutate(q1_se = q1_sd/sqrt(n))
hab_colors <- c(Kelp="seagreen4", No_kelp="seagreen2",
I="blue", M="lightsalmon1", O="firebrick3")
hab_shape <- c(Kelp=15, No_kelp=15,
I=25, M=25, O=25)
View(TD_beta_nokelp_done)
taxo_diss_Hill <- TD_beta_toplot %>%
select(Year, Habitat, q1) %>%
group_by(Year, Habitat) %>%
summarise( n = n(),
q1_mean = mean(q1),
q1_sd = sd(q1)
) %>%
mutate(q1_se = q1_sd/sqrt(n))
View(taxo_diss_Hill)
FD_beta_kelp$Habitat <- "Kelp"
FD_beta_nokelp$Habitat <- "No_kelp"
FD_beta_kelp$Year <- ifelse(FD_beta_kelp$Year1 == FD_beta_kelp$Year2,
FD_beta_kelp$Year1, NA)
FD_beta_nokelp$Year <- ifelse(FD_beta_nokelp$Year1 == FD_beta_nokelp$Year2,
FD_beta_nokelp$Year1, NA)
FD_beta_kelp_done <- na.omit(FD_beta_kelp)%>%
select(Year, q0, q1, q2, Habitat)
FD_beta_nokelp_done <- na.omit(FD_beta_nokelp)%>%
select(Year, q0, q1, q2, Habitat)
FD_beta_spatial$Habitat <- ifelse(FD_beta_spatial$Habitat1 == FD_beta_spatial$Habitat2,
FD_beta_spatial$Habitat1, NA)
FD_beta_spatial$Year <- "2013"
FD_beta_spatial_done <- na.omit(FD_beta_spatial)%>%
select(Year, q0, q1, q2, Habitat)
FD_beta_toplot <- rbind(FD_beta_kelp_done,
FD_beta_nokelp_done, FD_beta_spatial_done )
func_diss_Hill <- FD_beta_toplot %>%
select(Year, Habitat, q1) %>%
group_by(Year, Habitat) %>%
summarise( n = n(),
q1_mean = mean(q1),
q1_sd = sd(q1)
) %>%
mutate(q1_se = q1_sd/sqrt(n))
View(func_diss_Hill)
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(mFD)
library(betapart)
library(dplyr)
load(here::here("data", "kelp_sp_occ.RData") )
load(here::here("data", "nokelp_sp_occ.RData") )
load(here::here("data", "kelp_nokelp_occ.RData") )
load(here::here("outputs", "sp_3D_coord.RData") )
load(here::here("data", "kelp_nokelp_metadata.RData") )
sp_dist_funct <- dist(sp_3D_coord)
kelp_nokelp_metadata <- as.data.frame(kelp_nokelp_metadata)
kelp_nokelp_occ <- kelp_nokelp_occ %>%
as.data.frame() %>%
rownames_to_column("Code") %>%
left_join(kelp_nokelp_metadata, kelp_nokelp_occ, by="Code" ) %>%
mutate(Site = paste(Code, Habitat, sep="-")) %>%
select(-Habitat, -Year, -Code) %>%
column_to_rownames("Site") %>%
as.matrix()
kelp_nokelp_tax_Hill   <- alpha.fd.hill (asb_sp_w = kelp_nokelp_occ,
sp_dist = sp_dist_funct,
q = 0, # Only 0 because the three values of q give same results (as is species richness)
tau= "min") #This gives you the taxonomic profile
TD_kelp_nokelp_Hill <- kelp_nokelp_tax_Hill$asb_FD_Hill %>%
as.data.frame() %>%
rownames_to_column("Code") %>%
mutate(Year1 = sub("-.*", "", Code), Year= sub(".*_", "", Year1), Habitat=sub(".*-", "", Code)) %>%
select(-Code, -Year1)
kelp_nokelp_alpha_FDhill <- mFD::alpha.fd.hill (asb_sp_w = kelp_nokelp_occ,
sp_dist = sp_dist_funct,
q = c(0, 1, 2),
tau= "mean") #This gives you functional diversity, as recommended in Chao et al 2019
FD_kelp_nokelp_Hill <- kelp_nokelp_alpha_FDhill$asb_FD_Hill %>%
as.data.frame() %>%
rownames_to_column("Code")%>%
mutate(Year1 = sub("-.*", "", Code), Year= sub(".*_", "", Year1), Habitat=sub(".*-", "", Code)) %>%
select(-Code, -Year1)
kelp_nokelp_beta_taxhill <-beta.fd.hill (asb_sp_w = kelp_nokelp_occ,
sp_dist = sp_dist_funct,
q = c(0, 1, 2),
tau= "min",
beta_type = "Jaccard")
TD_beta_kelp_nokelp <- dist.to.df(kelp_nokelp_beta_taxhill$beta_fd_q) %>%
as.data.frame() %>%
mutate(Yearx=sub("-.*", "", x1), Yeary=sub("-.*", "", x2), Habitat1=sub(".*-", "", x1), Habitat2=sub(".*-", "", x2),
Year1=sub(".*_", "", Yearx),  Year2=sub(".*_", "", Yeary)) %>%
select(Year1, Year2, q0, q1, q2, Habitat1, Habitat2)
# functional dissimilarity
kelp_nokelp_beta_FDhill <- mFD::beta.fd.hill (asb_sp_w = kelp_nokelp_occ,
sp_dist = sp_dist_funct,
q = c(0, 1, 2),
tau= "mean",
beta_type = "Jaccard")
FD_beta_kelp_nokelp <- dist.to.df(kelp_nokelp_beta_FDhill$beta_fd_q)%>%
as.data.frame() %>%
mutate(Yearx=sub("-.*", "", x1), Yeary=sub("-.*", "", x2), Habitat1=sub(".*-", "", x1), Habitat2=sub(".*-", "", x2),
Year1=sub(".*_", "", Yearx),  Year2=sub(".*_", "", Yeary)) %>%
select(Year1, Year2, q0, q1, q2, Habitat1, Habitat2)
FD_beta_kelp_nokelp_Hill_sites <- dist.to.df(kelp_nokelp_beta_FDhill$beta_fd_q)%>%
mutate(Yearx=sub("-.*", "", x1), Yeary=sub("-.*", "", x2), Habitat1=sub(".*-", "", x1), Habitat2=sub(".*-", "", x2),
Year1=sub(".*_", "", Yearx),  Year2=sub(".*_", "", Yeary)) %>%
mutate(Site=sub("_.*", "", x1)) %>%
select(Year1, Year2, Site, q0, q1, q2)
View(FD_beta_kelp_nokelp_Hill_sites)
View(kelp_nokelp_occ)
FD_beta_kelp_nokelp_Hill_sites <- dist.to.df(kelp_nokelp_beta_FDhill$beta_fd_q)%>%
mutate(Yearx=sub("-.*", "", x1), Yeary=sub("-.*", "", x2), Habitat1=sub(".*-", "", x1), Habitat2=sub(".*-", "", x2),
Year1=sub(".*_", "", Yearx),  Year2=sub(".*_", "", Yeary)) %>%
mutate(Site=sub("_.*", "", x1)) %>%
select(Year1, Year2, Site, q0, q1, q2, Habitat1, Habitat2)
View(FD_beta_kelp_nokelp_Hill_sites)
View(FD_kelp_nokelp_Hill)
View(FD_beta_kelp_nokelp)
FD_beta_kelp_nokelp_Hill_sites <- dist.to.df(kelp_nokelp_beta_FDhill$beta_fd_q)%>%
mutate(Yearx=sub("-.*", "", x1), Yeary=sub("-.*", "", x2), Habitat1=sub(".*-", "", x1), Habitat2=sub(".*-", "", x2),
Year1=sub(".*_", "", Yearx),  Year2=sub(".*_", "", Yeary)) %>%
mutate(Site=sub("_.*", "", x1)) %>%
filter(Year1 == Year2, Habitat1==Habitat2) %>%
select(Year1, Site, q0, q1, q2)
View(FD_beta_kelp_nokelp_Hill_sites)
View(FD_beta_kelp_nokelp)
FD_beta_kelp_nokelp <- dist.to.df(kelp_nokelp_beta_FDhill$beta_fd_q)%>%
as.data.frame() %>%
mutate(Yearx=sub("-.*", "", x1), Yeary=sub("-.*", "", x2), Habitat1=sub(".*-", "", x1), Habitat2=sub(".*-", "", x2),
Year1=sub(".*_", "", Yearx),  Year2=sub(".*_", "", Yeary)) %>%
mutate(Site=sub("_.*", "", x1)) %>%
select(Year1, Year2, q0, q1, q2, Habitat1, Habitat2)
FD_beta_kelp_nokelp <- dist.to.df(kelp_nokelp_beta_FDhill$beta_fd_q)%>%
as.data.frame() %>%
mutate(Yearx=sub("-.*", "", x1), Yeary=sub("-.*", "", x2), Habitat1=sub(".*-", "", x1), Habitat2=sub(".*-", "", x2),
Year1=sub(".*_", "", Yearx),  Year2=sub(".*_", "", Yeary)) %>%
mutate(Site=sub("_.*", "", x1)) %>%
select(Year1, Year2, q0, q1, q2, Habitat1, Habitat2, Site)
View(FD_beta_kelp_nokelp)
TD_beta_kelp_nokelp_Hill_sites <- dist.to.df(kelp_nokelp_beta_taxhill$beta_fd_q)%>%
mutate(Yearx=sub("-.*", "", x1), Yeary=sub("-.*", "", x2), Habitat1=sub(".*-", "", x1), Habitat2=sub(".*-", "", x2),
Year1=sub(".*_", "", Yearx),  Year2=sub(".*_", "", Yeary)) %>%
mutate(Site=sub("_.*", "", x1)) %>%
filter(Year1 == Year2, Habitat1==Habitat2) %>%
select(Year1, Site, q0, q1, q2)
View(TD_beta_kelp_nokelp_Hill_sites)
rm(list=ls()) # cleaning memory
library(vegan)
library(glmmTMB)
library(car)
save(FD_beta_kelp_nokelp_Hill_sites, file=here::here("outputs/", "FD_beta_kelp_nokelp_Hill_sites.RData") )
FD_beta_kelp_nokelp_Hill_sites <- dist.to.df(kelp_nokelp_beta_FDhill$beta_fd_q)%>%
mutate(Yearx=sub("-.*", "", x1), Yeary=sub("-.*", "", x2), Habitat1=sub(".*-", "", x1), Habitat2=sub(".*-", "", x2),
Year1=sub(".*_", "", Yearx),  Year2=sub(".*_", "", Yeary)) %>%
mutate(Site=sub("_.*", "", x1)) %>%
filter(Year1 == Year2, Habitat1==Habitat2) %>%
select(Year1, Site, q0, q1, q2)
################################################################################
##
## Script for computing taxonomic and functional diversity and dissimilarity
## between years using Hill numbers
##
## Code by Camille Magneville, SÃ©bastien VillÃ©ger and Paula Sgarlatta
##
################################################################################
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(mFD)
library(betapart)
library(dplyr)
# loading data
load(here::here("data", "kelp_sp_occ.RData") )
load(here::here("data", "nokelp_sp_occ.RData") )
load(here::here("data", "kelp_nokelp_occ.RData") )
load(here::here("outputs", "sp_3D_coord.RData") )
load(here::here("data", "kelp_nokelp_metadata.RData") )
# computing Euclidean distance between species in the 3D space
sp_dist_funct <- dist(sp_3D_coord)
kelp_nokelp_metadata <- as.data.frame(kelp_nokelp_metadata)
## computing functional diversity based on Hill numbers ####
####### KELP/NO KELP #####
## Change sites to habitat
kelp_nokelp_occ <- kelp_nokelp_occ %>%
as.data.frame() %>%
rownames_to_column("Code") %>%
left_join(kelp_nokelp_metadata, kelp_nokelp_occ, by="Code" ) %>%
mutate(Site = paste(Code, Habitat, sep="-")) %>%
select(-Habitat, -Year, -Code) %>%
column_to_rownames("Site") %>%
as.matrix()
#Taxonomic diversity
kelp_nokelp_tax_Hill   <- alpha.fd.hill (asb_sp_w = kelp_nokelp_occ,
sp_dist = sp_dist_funct,
q = 0, # Only 0 because the three values of q give same results (as is species richness)
tau= "min") #This gives you the taxonomic profile
TD_kelp_nokelp_Hill <- kelp_nokelp_tax_Hill$asb_FD_Hill %>%
as.data.frame() %>%
rownames_to_column("Code") %>%
mutate(Year1 = sub("-.*", "", Code), Year= sub(".*_", "", Year1), Habitat=sub(".*-", "", Code)) %>%
select(-Code, -Year1)
# Functional diversity: number of species, functional richness, dispersion and identity (along 3 axes)
kelp_nokelp_alpha_FDhill <- mFD::alpha.fd.hill (asb_sp_w = kelp_nokelp_occ,
sp_dist = sp_dist_funct,
q = c(0, 1, 2),
tau= "mean") #This gives you functional diversity, as recommended in Chao et al 2019
FD_kelp_nokelp_Hill <- kelp_nokelp_alpha_FDhill$asb_FD_Hill %>%
as.data.frame() %>%
rownames_to_column("Code")%>%
mutate(Year1 = sub("-.*", "", Code), Year= sub(".*_", "", Year1), Habitat=sub(".*-", "", Code)) %>%
select(-Code, -Year1)
## computing tax/functional beta-diversity based on Hill numbers ####
#Taxonomic dissimilarity
kelp_nokelp_beta_taxhill <-beta.fd.hill (asb_sp_w = kelp_nokelp_occ,
sp_dist = sp_dist_funct,
q = c(0, 1, 2),
tau= "min",
beta_type = "Jaccard")
# Then use the mFD::dist.to.df function to ease visualizing result
TD_beta_kelp_nokelp <- dist.to.df(kelp_nokelp_beta_taxhill$beta_fd_q) %>%
as.data.frame() %>%
mutate(Yearx=sub("-.*", "", x1), Yeary=sub("-.*", "", x2), Habitat1=sub(".*-", "", x1), Habitat2=sub(".*-", "", x2),
Year1=sub(".*_", "", Yearx),  Year2=sub(".*_", "", Yeary)) %>%
select(Year1, Year2, q0, q1, q2, Habitat1, Habitat2)
# functional dissimilarity
kelp_nokelp_beta_FDhill <- mFD::beta.fd.hill (asb_sp_w = kelp_nokelp_occ,
sp_dist = sp_dist_funct,
q = c(0, 1, 2),
tau= "mean",
beta_type = "Jaccard")
# Then use the mFD::dist.to.df function to ease visualizing result
FD_beta_kelp_nokelp <- dist.to.df(kelp_nokelp_beta_FDhill$beta_fd_q)%>%
as.data.frame() %>%
mutate(Yearx=sub("-.*", "", x1), Yeary=sub("-.*", "", x2), Habitat1=sub(".*-", "", x1), Habitat2=sub(".*-", "", x2),
Year1=sub(".*_", "", Yearx),  Year2=sub(".*_", "", Yeary)) %>%
mutate(Site=sub("_.*", "", x1)) %>%
select(Year1, Year2, q0, q1, q2, Habitat1, Habitat2, Site)
#For stats
FD_beta_kelp_nokelp_Hill_sites <- dist.to.df(kelp_nokelp_beta_FDhill$beta_fd_q)%>%
mutate(Yearx=sub("-.*", "", x1), Yeary=sub("-.*", "", x2), Habitat1=sub(".*-", "", x1), Habitat2=sub(".*-", "", x2),
Year1=sub(".*_", "", Yearx),  Year2=sub(".*_", "", Yeary)) %>%
mutate(Site=sub("_.*", "", x1)) %>%
filter(Year1 == Year2, Habitat1==Habitat2) %>%
select(Year1, Site, q0, q1, q2)
TD_beta_kelp_nokelp_Hill_sites <- dist.to.df(kelp_nokelp_beta_taxhill$beta_fd_q)%>%
mutate(Yearx=sub("-.*", "", x1), Yeary=sub("-.*", "", x2), Habitat1=sub(".*-", "", x1), Habitat2=sub(".*-", "", x2),
Year1=sub(".*_", "", Yearx),  Year2=sub(".*_", "", Yeary)) %>%
mutate(Site=sub("_.*", "", x1)) %>%
filter(Year1 == Year2, Habitat1==Habitat2) %>%
select(Year1, Site, q0, q1, q2)
save(FD_beta_kelp_nokelp_Hill_sites, file=here::here("outputs/", "FD_beta_kelp_nokelp_Hill_sites.RData") )
save(TD_beta_kelp_nokelp_Hill_sites, file=here::here("outputs/", "TD_beta_kelp_nokelp_Hill_sites.RData") )
load(here::here("outputs", "TD_beta_kelp_nokelp_Hill_sites.RData") )
load(here::here("outputs", "FD_beta_kelp_nokelp_Hill_sites.RData") )
kelp_tax_Hill   <- alpha.fd.hill (asb_sp_w = kelp_sp_occ,
sp_dist = sp_dist_funct,
q = 0, # Only 0 because the three values of q give same results (as is species richness)
tau= "min") #This gives you the taxonomic profile
TD_kelp_Hill <- kelp_tax_Hill$asb_FD_Hill
kelp_alpha_FDhill <- mFD::alpha.fd.hill (asb_sp_w = kelp_sp_occ,
sp_dist = sp_dist_funct,
q = c(0, 1, 2),
tau= "mean") #This gives you functional diversity, as recommended in Chao et al 2019
FD_kelp_Hill <- kelp_alpha_FDhill$asb_FD_Hill
kelp_beta_taxhill <-beta.fd.hill (asb_sp_w = kelp_sp_occ,
sp_dist = sp_dist_funct,
q = c(0, 1, 2),
tau= "min",
beta_type = "Jaccard")
TD_beta_kelp <- dist.to.df(kelp_beta_taxhill$beta_fd_q) %>%
mutate(Year1=sub(".*_", "", x1), Year2=sub(".*_", "", x2)) %>%
select(Year1, Year2, q0, q1, q2)
# functional dissimilarity
kelp_beta_FDhill <- mFD::beta.fd.hill (asb_sp_w = kelp_sp_occ,
sp_dist = sp_dist_funct,
q = c(0, 1, 2),
tau= "mean",
beta_type = "Jaccard")
FD_beta_kelp <- dist.to.df(kelp_beta_FDhill$beta_fd_q)%>%
mutate(Year1=sub(".*_", "", x1), Year2=sub(".*_", "", x2)) %>%
select(Year1, Year2, q0, q1, q2)
FD_beta_kelp_Hill_sites <- dist.to.df(kelp_beta_FDhill$beta_fd_q)%>%
mutate(Year1=sub(".*_", "", x1), Year2=sub(".*_", "", x2)) %>%
mutate(Site=sub("_.*", "", x1)) %>%
select(Year1, Year2, Site, q0, q1, q2)
TD_beta_kelp_Hill_sites <- dist.to.df(kelp_beta_taxhill$beta_fd_q)%>%
mutate(Year1=sub(".*_", "", x1), Year2=sub(".*_", "", x2)) %>%
mutate(Site=sub("_.*", "", x1)) %>%
select(Year1, Year2, Site, q0, q1, q2)
save(TD_kelp_Hill, file=here::here("outputs/", "TD_kelp_Hill.RData") )
save(FD_kelp_Hill, file=here::here("outputs/", "FD_kelp_Hill.RData") )
save(TD_beta_kelp, file=here::here("outputs/", "TD_beta_kelp_Hill.RData") )
save(FD_beta_kelp, file=here::here("outputs/", "FD_beta_kelp_Hill.RData") )
save(FD_beta_kelp_Hill_sites, file=here::here("outputs/", "FD_beta_kelp_Hill_sites.RData") )
save(TD_beta_kelp_Hill_sites, file=here::here("outputs/", "TD_beta_kelp_Hill_sites.RData") )
nokelp_tax_Hill   <- alpha.fd.hill (asb_sp_w = nokelp_sp_occ,
sp_dist = sp_dist_funct,
q = 0, # Only 0 because the three values of q give same results (as is species richness)
tau= "min") #This gives you the taxonomic profile
TD_nokelp_Hill <- nokelp_tax_Hill$asb_FD_Hill
nokelp_alpha_FDhill <- mFD::alpha.fd.hill (asb_sp_w = nokelp_sp_occ,
sp_dist = sp_dist_funct,
q = c(0, 1, 2),
tau= "mean") #This gives you functional diversity, as recommended in Chao et al 2019
FD_nokelp_Hill <- nokelp_alpha_FDhill$asb_FD_Hill
nokelp_beta_taxhill <-beta.fd.hill (asb_sp_w = nokelp_sp_occ,
sp_dist = sp_dist_funct,
q = c(0,1, 2),
tau= "min",
beta_type = "Jaccard")
TD_beta_nokelp <- dist.to.df(nokelp_beta_taxhill$beta_fd_q) %>%
mutate(Year1=sub(".*_", "", x1), Year2=sub(".*_", "", x2)) %>%
select(Year1, Year2, q0, q1, q2)
# functional dissimilarity
nokelp_beta_FDhill <- mFD::beta.fd.hill (asb_sp_w = nokelp_sp_occ,
sp_dist = sp_dist_funct,
q = c(0, 1, 2),
tau= "mean",
beta_type = "Jaccard")
FD_beta_nokelp <- dist.to.df(nokelp_beta_FDhill$beta_fd_q)%>%
mutate(Year1=sub(".*_", "", x1), Year2=sub(".*_", "", x2)) %>%
select(Year1, Year2, q0, q1, q2)
FD_beta_nokelp_sites <- dist.to.df(nokelp_beta_FDhill$beta_fd_q)%>%
mutate(Year1=sub(".*_", "", x1), Year2=sub(".*_", "", x2)) %>%
mutate(Site=sub("_.*", "", x1)) %>%
select(Year1, Year2, Site, q0, q1, q2)
TD_beta_nokelp_sites <- dist.to.df(nokelp_beta_taxhill$beta_fd_q)%>%
mutate(Year1=sub(".*_", "", x1), Year2=sub(".*_", "", x2)) %>%
mutate(Site=sub("_.*", "", x1)) %>%
select(Year1, Year2, Site, q0, q1, q2)
save(FD_beta_nokelp_sites, file=here::here("outputs/", "FD_beta_nokelp_sites.RData") )
save(TD_beta_nokelp_sites, file=here::here("outputs/", "TD_beta_nokelp_sites.RData") )
load(here::here("outputs", "TD_beta_kelp_Hill_sites.RData") )
load(here::here("outputs", "FD_beta_kelp_Hill_sites.RData") )
View(FD_beta_kelp_Hill_sites)
fx_beta_stats <- FD_beta_kelp_Hill_sites %>%
filter(Year1==Year2) %>%
mutate(Year=Year1) %>%
select(Year, Site, q1)
View(fx_beta_stats)
View(FD_beta_kelp_Hill_sites)
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(mFD)
library(betapart)
library(dplyr)
# loading data
load(here::here("data", "kelp_sp_occ.RData") )
load(here::here("data", "nokelp_sp_occ.RData") )
load(here::here("data", "kelp_nokelp_occ.RData") )
load(here::here("outputs", "sp_3D_coord.RData") )
load(here::here("data", "kelp_nokelp_metadata.RData") )
sp_dist_funct <- dist(sp_3D_coord)
kelp_tax_Hill   <- alpha.fd.hill (asb_sp_w = kelp_sp_occ,
sp_dist = sp_dist_funct,
q = 0, # Only 0 because the three values of q give same results (as is species richness)
tau= "min") #This gives you the taxonomic profile
TD_kelp_Hill <- kelp_tax_Hill$asb_FD_Hill
View(TD_kelp_Hill)
kelp_alpha_FDhill <- mFD::alpha.fd.hill (asb_sp_w = kelp_sp_occ,
sp_dist = sp_dist_funct,
q = c(0, 1, 2),
tau= "mean") #This gives you functional diversity, as recommended in Chao et al 2019
FD_kelp_Hill <- kelp_alpha_FDhill$asb_FD_Hill
kelp_beta_taxhill <-beta.fd.hill (asb_sp_w = kelp_sp_occ,
sp_dist = sp_dist_funct,
q = c(0, 1, 2),
tau= "min",
beta_type = "Jaccard")
TD_beta_kelp <- dist.to.df(kelp_beta_taxhill$beta_fd_q) %>%
mutate(Year1=sub(".*_", "", x1), Year2=sub(".*_", "", x2)) %>%
select(Year1, Year2, q0, q1, q2)
# functional dissimilarity
kelp_beta_FDhill <- mFD::beta.fd.hill (asb_sp_w = kelp_sp_occ,
sp_dist = sp_dist_funct,
q = c(0, 1, 2),
tau= "mean",
beta_type = "Jaccard")
FD_beta_kelp <- dist.to.df(kelp_beta_FDhill$beta_fd_q)%>%
mutate(Year1=sub(".*_", "", x1), Year2=sub(".*_", "", x2)) %>%
select(Year1, Year2, q0, q1, q2)
FD_beta_kelp <- dist.to.df(kelp_beta_FDhill$beta_fd_q)%>%
mutate(Year1=sub(".*_", "", x1), Year2=sub(".*_", "", x2)) %>%
select(Year1, Year2, q0, q1, q2, x1, x2)
View(FD_beta_kelp)
FBeta_Hill_temporal <- glmmTMB(q2 ~ Year + (1|Site), data = beta_stats, family = beta_family())
FBeta_Hill_temporal <- glmmTMB(q2 ~ Year + (1|Site), data = fx_beta_stats, family = beta_family())
fx_beta_stats <- FD_beta_kelp_Hill_sites %>%
filter(Year1==Year2) %>%
mutate(Year=Year1) %>%
select(Year, Site, q1)
rm(list=ls()) # cleaning memory
##Load packages
library(vegan)
library(glmmTMB)
library(car)
load(here::here("outputs", "TD_beta_kelp_nokelp_Hill_sites.RData") )
load(here::here("outputs", "FD_beta_kelp_nokelp_Hill_sites.RData") )
load(here::here("outputs", "TD_beta_nokelp_sites.RData") )
load(here::here("outputs", "FD_beta_nokelp_sites.RData") )
load(here::here("outputs", "TD_beta_kelp_Hill_sites.RData") )
load(here::here("outputs", "FD_beta_kelp_Hill_sites.RData") )
## Preparing data for stats
fx_beta_stats <- FD_beta_kelp_Hill_sites %>%
filter(Year1==Year2) %>%
mutate(Year=Year1) %>%
select(Year, Site, q1)
##GLMM
FBeta_Hill_temporal <- glmmTMB(q2 ~ Year + (1|Site), data = fx_beta_stats, family = beta_family())
FBeta_Hill_temporal <- glmmTMB(q1 ~ Year + (1|Site), data = fx_beta_stats, family = beta_family())
summary(FBeta_Hill_temporal)
mod<-lm(q1 ~ Year,
data = fx_beta_stats)
summary(mod)
Anova(mod)
library(DHARMa)
mod.res <- simulateResiduals(mod)
plot(mod.res)
library(emmeans)
emmeans(mod, pairwise ~ Year)
emmeans(FBeta_Hill_temporal, pairwise ~ Year)
fx_beta_stats_nokelp <- FD_beta_nokelp_sites %>%
filter(Year1==Year2) %>%
mutate(Year=Year1) %>%
select(Year, Site, q1)
View(fx_beta_stats_nokelp)
mod.res <- simulateResiduals(FBeta_Hill_temporal)
plot(mod.res)
FBeta_Hill_temporal_nk <- glmmTMB(q1 ~ Year + (1|Site), data = fx_beta_stats_nokelp, family = beta_family())
summary(FBeta_Hill_temporal_nk)
mod.res <- simulateResiduals(FBeta_Hill_temporal)
plot(mod.res)
mod.res_nk <- simulateResiduals(FBeta_Hill_temporal_nk)
plot(mod.res_nk)
emmeans(FBeta_Hill_temporal_nk, pairwise ~ Year)
