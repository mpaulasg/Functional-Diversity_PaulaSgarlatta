)
}# end of h
if (z==1) {
nlabels_y <- length(years_colors)
ggplot_z <- ggplot_z +
geom_text(aes(x = rep(range_axes[1]*0.9, nlabels_y ),
y = range_axes[2]*(1.05-0.15*(1:nlabels_y)),
label = names(years_colors) ),
color = years_colors,
hjust = "left",
show.legend = FALSE) +
ggtitle("Temporal - Kelp")
}
# ggplot stored in list
ggplot_temporal_kelp[[z]]<-ggplot_z
}# end of z
# computing occurrences of species in each habitat
nokelp_years_sp_occ <- rbind(
y2002 = apply(nokelp_sp_occ [nokelp_metadata[which(nokelp_metadata$Year=="2002"),"Code"],],2,max ),
y2008 = apply(nokelp_sp_occ [nokelp_metadata[which(nokelp_metadata$Year=="2008"),"Code"],],2,max ),
y2013 = apply(nokelp_sp_occ [nokelp_metadata[which(nokelp_metadata$Year=="2013"),"Code"],],2,max ),
y2018 = apply(nokelp_sp_occ [nokelp_metadata[which(nokelp_metadata$Year=="2018"),"Code"],],2,max )
)
# compute FRic for all habitats  ---
nokelp_years_multidimFD<-alpha.fd.multidim(sp_faxes_coord = sp_3D_coord,
asb_sp_w = nokelp_years_sp_occ,
ind_vect = c("fric"),
scaling = TRUE,
details_returned = TRUE
)
# list to store ggplot
ggplot_temporal_nokelp<-list()
# pairs of axes
pairs_axes<-list( c(1,2), c(1,3) )
for ( z in 1:length(pairs_axes) ) {
# names of axes
xy<-pairs_axes[[z]]
# background with axes range set + title
ggplot_z<-background.plot(range_faxes=range_axes,
faxes_nm=paste0("PC", xy),
color_bg="grey95")
# convex hull of species pool
ggplot_z<-pool.plot(ggplot_bg=ggplot_z,
sp_coord2D=pool_coord[,xy],
vertices_nD=pool_vert_nm,
plot_pool=FALSE,
color_ch=NA, fill_ch="white", alpha_ch=1)
# loop on years
for (h in row.names(nokelp_years_sp_occ) ) {
# color given habitat
col_h<-as.character(years_colors[h])
# species present in v
sp_h<-names(which(nokelp_years_multidimFD$details$asb_sp_occ[h,]==1))
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=nokelp_years_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = FALSE,
color_ch=c(vv=col_h),
fill_ch=c(vv=col_h),
alpha_ch=c(vv=0.1)
)
}# end of v
if (z==1) {
ggplot_z <- ggplot_z +
ggtitle("Temporal - No Kelp")
}
# ggplot stored in list
ggplot_temporal_nokelp[[z]]<-ggplot_z
}# end of z
# computing occurrences of species in each habitat
hab_sp_occ <- rbind(
Inshore = apply(spatial_sp_occ [spatial_metadata[which(spatial_metadata$Habitat=="Inshore"),"Code"],],2,max ),
Midshelf = apply(spatial_sp_occ [spatial_metadata[which(spatial_metadata$Habitat=="Midshelf"),"Code"],],2,max ),
Offshore = apply(spatial_sp_occ [spatial_metadata[which(spatial_metadata$Habitat=="Offshore"),"Code"],],2,max )
)
# compute FRic for all habitats  ---
hab_multidimFD<-alpha.fd.multidim(sp_faxes_coord = sp_3D_coord,
asb_sp_w = hab_sp_occ,
ind_vect = c("fric"),
scaling = TRUE,
details_returned = TRUE
)
# color code for the 3 habitats
hab_colors <- c(Inshore="gold1", Midshelf="red2", Offshore="blue3")
# list to store ggplot
ggplot_spatial<-list()
# pairs of axes
pairs_axes<-list( c(1,2), c(1,3) )
for ( z in 1:length(pairs_axes) ) {
# names of axes
xy<-pairs_axes[[z]]
# background with axes range set + title
ggplot_z<-background.plot(range_faxes=range_axes,
faxes_nm=paste0("PC", xy),
color_bg="grey95")
# convex hull of species pool
ggplot_z<-pool.plot(ggplot_bg=ggplot_z,
sp_coord2D=pool_coord[,xy],
vertices_nD=pool_vert_nm,
plot_pool=FALSE,
color_ch=NA, fill_ch="white", alpha_ch=1)
# loop on habitats
for (h in row.names(hab_sp_occ) ) {
# color given habitat
col_h<-as.character(hab_colors[h])
# species present in v
sp_h<-names(which(hab_multidimFD$details$asb_sp_occ[h,]==1))
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=hab_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = FALSE,
color_ch=c(vv=col_h),
fill_ch=c(vv=col_h),
alpha_ch=c(vv=0.1)
)
}# end of h
# legend
if (z==1) {
nlabels_h <- length(hab_colors)
ggplot_z <- ggplot_z +
geom_text(aes(x = rep(range_axes[1]*0.9, nlabels_h ),
y = range_axes[2]*(1.05-0.15*(1:nlabels_h)),
label = names(hab_colors),
color = hab_colors ),
hjust = "left",
show.legend = FALSE) +
ggtitle("Spatial")
}
# ggplot stored in list
ggplot_spatial[[z]] <- ggplot_z
}# end of z
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=hab_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = TRUE,
color_ch=c(vv=col_h),
fill_ch=c(vv=col_h),
alpha_ch=c(vv=0.1)
)
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=hab_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = TRUE,
size_sp = 3,
color_ch=c(vv=col_h),
fill_ch=c(vv=col_h),
alpha_ch=c(vv=0.1)
)
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=hab_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = TRUE,
size_sp = c(vv=3),
color_ch=c(vv=col_h),
fill_ch=c(vv=col_h),
alpha_ch=c(vv=0.1)
)
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=hab_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = TRUE,
size_sp = c(vv=3),
size_vert = c(vv=3),
color_ch=c(vv=col_h),
fill_ch=c(vv=col_h),
alpha_ch=c(vv=0.1)
)
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=hab_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = TRUE,
size_sp = c(vv=3),
size_vert = c(vv=3),
shape_sp = c(vv=3),
color_ch=c(vv=col_h),
fill_ch=c(vv=col_h),
alpha_ch=c(vv=0.1)
)
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=hab_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = TRUE,
size_sp = c(vv=3),
size_vert = c(vv=3),
shape_sp = c(vv=3),
shape_vert = c(vv=3),
color_ch=c(vv=col_h),
fill_ch=c(vv=col_h),
alpha_ch=c(vv=0.1)
)
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=hab_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = TRUE,
size_sp = c(vv=3),
size_vert = c(vv=3),
shape_sp = c(vv=3),
color_sp = c(vv=3),
shape_vert = c(vv=3),
color_ch=c(vv=col_h),
fill_ch=c(vv=col_h),
alpha_ch=c(vv=0.1)
)
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=hab_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = TRUE,
size_sp = c(vv=3),
size_vert = c(vv=3),
color_vert = c(vv=col_h),
shape_sp = c(vv=3),
color_sp = c(vv=col_h),
shape_vert = c(vv=3),
color_ch=c(vv=col_h),
fill_ch=c(vv=col_h),
alpha_ch=c(vv=0.1)
)
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=hab_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = TRUE,
size_sp = c(vv=3),
size_vert = c(vv=3),
color_vert = c(vv=col_h),
shape_sp = c(vv=3),
color_sp = c(vv=col_h),
fill_sp=c(vv=col_h),
shape_vert = c(vv=3),
color_ch=c(vv=col_h),
fill_ch=c(vv=col_h),
alpha_ch=c(vv=0.1)
)
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=hab_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = TRUE,
size_sp = c(vv=3),
size_vert = c(vv=3),
color_vert = c(vv=col_h),
fill_vert = c(vv=col_h),
shape_sp = c(vv=3),
color_sp = c(vv=col_h),
fill_sp=c(vv=col_h),
shape_vert = c(vv=3),
color_ch=c(vv=col_h),
fill_ch=c(vv=col_h),
alpha_ch=c(vv=0.1)
)
ggplot_z
hab_colors[h]
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=hab_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = TRUE,
size_sp = c(vv=3),
size_vert = c(vv=3),
color_vert = c(vv=hab_colors),
fill_vert = c(vv=hab_colors),
shape_sp = c(vv=3),
color_sp = c(vv=hab_colors),
fill_sp=c(vv=hab_colors),
shape_vert = c(vv=3),
color_ch=c(vv=hab_colors),
fill_ch=c(vv=hab_colors),
alpha_ch=c(vv=0.1)
)
ggplot_
ggplot_z
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(patchwork)
library(mFD)
# loading data
load(here::here("outputs", "sp_3D_coord.RData") )
load(here::here("data", "spatial_metadata.RData") )
load(here::here("data", "spatial_sp_occ.RData") )
load(here::here("outputs/", "spatial_fd.RData") )
load(here::here("data", "kelp_metadata.RData") )
load(here::here("data", "kelp_sp_occ.RData") )
load(here::here("data", "nokelp_metadata.RData") )
load(here::here("data", "nokelp_sp_occ.RData") )
# coordinates of all species ----
pool_coord<-spatial_fd$details$sp_faxes_coord
# vertices of all fe in 4D ----
pool_vert_nm<-spatial_fd$details$pool_vert_nm
View(spatial_fd)
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(patchwork)
library(mFD)
# loading data
load(here::here("outputs", "sp_3D_coord.RData") )
load(here::here("data", "spatial_metadata.RData") )
load(here::here("data", "spatial_sp_occ.RData") )
load(here::here("outputs/", "spatial_fd.RData") )
load(here::here("data", "kelp_metadata.RData") )
load(here::here("data", "kelp_sp_occ.RData") )
load(here::here("data", "nokelp_metadata.RData") )
load(here::here("data", "nokelp_sp_occ.RData") )
# coordinates of all species ----
pool_coord<-spatial_fd$details$sp_faxes_coord
View(pool_coord)
# vertices of all fe in 4D ----
pool_vert_nm<-spatial_fd$details$pool_vert_nm
# range of axes
range_faxes_coord <- range(pool_coord[,1:3])
range_axes <- range_faxes_coord +
c(-1, 1) * (range_faxes_coord[2] - range_faxes_coord[1]) * 0.1
names(spatial_fd$details$asb_vert_nm)
spatial_metadata
# computing occurrences of species in each habitat
kelp_years_sp_occ <- rbind(
y2002 = apply(kelp_sp_occ [kelp_metadata[which(kelp_metadata$Year=="2002"),"Code"],],2,max ),
y2008 = apply(kelp_sp_occ [kelp_metadata[which(kelp_metadata$Year=="2008"),"Code"],],2,max ),
y2013 = apply(kelp_sp_occ [kelp_metadata[which(kelp_metadata$Year=="2013"),"Code"],],2,max ),
y2018 = apply(kelp_sp_occ [kelp_metadata[which(kelp_metadata$Year=="2018"),"Code"],],2,max )
)
# compute FRic for all habitats  ---
kelp_years_multidimFD<-alpha.fd.multidim(sp_faxes_coord = sp_3D_coord,
asb_sp_w = kelp_years_sp_occ,
ind_vect = c("fric"),
scaling = TRUE,
details_returned = TRUE
)
# color code for the 4 years
years_colors <- c(y2002="green3", y2008="blue3", y2013="grey50", y2018="red3")
# list to store ggplot
ggplot_temporal_kelp<-list()
# pairs of axes
pairs_axes<-list( c(1,2), c(1,3) )
for ( z in 1:length(pairs_axes) ) {
# names of axes
xy<-pairs_axes[[z]]
# background with axes range set + title
ggplot_z<-background.plot(range_faxes=range_axes,
faxes_nm=paste0("PC", xy),
color_bg="grey95")
# convex hull of species pool
ggplot_z<-pool.plot(ggplot_bg=ggplot_z,
sp_coord2D=pool_coord[,xy],
vertices_nD=pool_vert_nm,
plot_pool=FALSE,
color_ch=NA, fill_ch="white", alpha_ch=1)
# loop on years
for (h in row.names(kelp_years_sp_occ) ) {
# color given habitat
col_h<-as.character(years_colors[h])
# species present in v
sp_h<-names(which(kelp_years_multidimFD$details$asb_sp_occ[h,]==1))
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=kelp_years_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = FALSE,
color_ch=c(vv=col_h),
fill_ch=c(vv=col_h),
alpha_ch=c(vv=0.1)
)
}# end of h
if (z==1) {
nlabels_y <- length(years_colors)
ggplot_z <- ggplot_z +
geom_text(aes(x = rep(range_axes[1]*0.9, nlabels_y ),
y = range_axes[2]*(1.05-0.15*(1:nlabels_y)),
label = names(years_colors) ),
color = years_colors,
hjust = "left",
show.legend = FALSE) +
ggtitle("Temporal - Kelp")
}
# ggplot stored in list
ggplot_temporal_kelp[[z]]<-ggplot_z
}# end of z
ggplot_z
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=kelp_years_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = TRUE,
color_sp = c(pool = "grey50", asb1 = "#1F968BFF", asb2 = "#DCE319FF"),
color_ch=c(vv=col_h),
fill_ch=c(vv=col_h),
alpha_ch=c(vv=0.1)
)
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
load(here::here("from_paula", "SpatialUVC_species_traits_only_thermal.csv") )
spatial_thermal <- read.csv(here::here("from_paula", "SpatialUVC_species_traits_only_thermal.csv") )
kelp_thermal <- read.csv(here::here("from_paula", "TemporalBRUV_species_traits_only_thermal_kelp.csv") )
nokelp_thermal <- read.csv(here::here("from_paula", "TemporalBRUV_species_traits_only_thermal_nokelp.csv") )
nokelp_thermal <- read.csv(here::here("from_paula", "TemporalBRUV_species_traits_only_thermal_no_kelp.csv") )
thermal_all <- bind_rows(spatial_thermal, kelp_thermal,
nokelp_thermal)
View(thermal_all)
thermal_all <- bind_rows(spatial_thermal, kelp_thermal,
nokelp_thermal)%>%
distinct(Species, .keep_all = TRUE ) %>%
as.data.frame()
View(thermal_all)
thermal_all <- thermal_all %>%
mutate(thermal=rowMeans(thermal_all, na.rm=TRUE))
thermal_all <- thermal_all %>%
mutate(thermal=rowMeans(thermal_all[ , c(2,3)], na.rm=TRUE))
thermal_all <- thermal_all %>%
mutate(thermal=rowMeans(thermal_all[ , c(2,3)], na.rm=TRUE)) %>%
select(Species, thermal)
write.csv(thermal_all, file=here::here("data", "raw_data", "thermal_all.csv"),
row.names = FALSE )
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(patchwork)
library(mFD)
# loading data
load(here::here("outputs", "sp_3D_coord.RData") )
load(here::here("data", "spatial_metadata.RData") )
load(here::here("data", "spatial_sp_occ.RData") )
load(here::here("outputs/", "spatial_fd.RData") )
load(here::here("data", "kelp_metadata.RData") )
load(here::here("data", "kelp_sp_occ.RData") )
load(here::here("data", "nokelp_metadata.RData") )
load(here::here("data", "nokelp_sp_occ.RData") )
thermal <- read.csv(here::here("data", "raw_data", "thermal_all.csv"))
View(thermal)
# coordinates of all species ----
pool_coord<-spatial_fd$details$sp_faxes_coord
View(pool_coord)
thermal <- read.csv(here::here("data", "raw_data", "thermal_all.csv")) %>%
rownames_to_column()
thermal <- read.csv(here::here("data", "raw_data", "thermal_all.csv")) %>%
rownames_to_column("Species")
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(patchwork)
library(mFD)
# loading data
load(here::here("outputs", "sp_3D_coord.RData") )
load(here::here("data", "spatial_metadata.RData") )
load(here::here("data", "spatial_sp_occ.RData") )
load(here::here("outputs/", "spatial_fd.RData") )
load(here::here("data", "kelp_metadata.RData") )
load(here::here("data", "kelp_sp_occ.RData") )
load(here::here("data", "nokelp_metadata.RData") )
load(here::here("data", "nokelp_sp_occ.RData") )
thermal <- read.csv(here::here("data", "raw_data", "thermal_all.csv")) %>%
rownames_to_column("Species")
thermal <- read.csv(here::here("data", "raw_data", "thermal_all.csv")) %>%
column_to_rownames("Species")
# coordinates of all species ----
pool_coord<-spatial_fd$details$sp_faxes_coord
# vertices of all fe in 4D ----
pool_vert_nm<-spatial_fd$details$pool_vert_nm
# range of axes
range_faxes_coord <- range(pool_coord[,1:3])
range_axes <- range_faxes_coord +
c(-1, 1) * (range_faxes_coord[2] - range_faxes_coord[1]) * 0.1
View(thermal)
thermal <- read.csv(here::here("data", "raw_data", "thermal_all.csv")) %>%
mutate(thermal_label= if_else(thermal>"23", "tropical", "temperate"))
thermal <- read.csv(here::here("data", "raw_data", "thermal_all.csv")) %>%
mutate(thermal_label= if_else(thermal>"23", "tropical", "temperate")) %>%
column_to_rownames("Species") %>%
select(thermal_label)
# coordinates of all species ----
pool_coord<-spatial_fd$details$sp_faxes_coord
# vertices of all fe in 4D ----
pool_vert_nm<-spatial_fd$details$pool_vert_nm
# range of axes
range_faxes_coord <- range(pool_coord[,1:3])
range_axes <- range_faxes_coord +
c(-1, 1) * (range_faxes_coord[2] - range_faxes_coord[1]) * 0.1
names(spatial_fd$details$asb_vert_nm)
spatial_metadata
# computing occurrences of species in each habitat
kelp_years_sp_occ <- rbind(
y2002 = apply(kelp_sp_occ [kelp_metadata[which(kelp_metadata$Year=="2002"),"Code"],],2,max ),
y2008 = apply(kelp_sp_occ [kelp_metadata[which(kelp_metadata$Year=="2008"),"Code"],],2,max ),
y2013 = apply(kelp_sp_occ [kelp_metadata[which(kelp_metadata$Year=="2013"),"Code"],],2,max ),
y2018 = apply(kelp_sp_occ [kelp_metadata[which(kelp_metadata$Year=="2018"),"Code"],],2,max )
)
# compute FRic for all habitats  ---
kelp_years_multidimFD<-alpha.fd.multidim(sp_faxes_coord = sp_3D_coord,
asb_sp_w = kelp_years_sp_occ,
ind_vect = c("fric"),
scaling = TRUE,
details_returned = TRUE
)
# color code for the 4 years
years_colors <- c(y2002="green3", y2008="blue3", y2013="grey50", y2018="red3")
View(pool_coord)
