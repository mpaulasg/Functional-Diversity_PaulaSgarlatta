relocate(Habitat, .before = Aulostomus_chinensis) %>%
pivot_longer(!Habitat, names_to = "Species", values_to = "Biomass") %>%
group_by(Habitat) %>%
pivot_wider(names_from = Species, values_from = Biomass)
################################################################################
##
## Script for plotting changes in the multidimensional functional space across
## habitats and over years in a multidimensional space
##
##  * changes in space and time (only 2002, 2009 and 2018) - Figure 4
##
##  * changes in time (all years) - Figure S7
##
##
## Code by Paula Sgarlatta, Camille Magneville and Sebastien Villeger
##
################################################################################
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(dplyr)
library(here)
library(patchwork)
library(mFD)
library(ggpubr)
library(fishualize)
# loading data
load(here::here("data", "sp_3D_coord.RData") )
load(here::here("data", "spatial_metadata.RData") )
load(here::here("data", "spatial_sp_biom.RData") )
load(here::here("data", "spatial_fd_biomass.RData") )
load(here::here("data", "kelp_metadata.RData") )
load(here::here("data", "kelp_sp_maxN.RData") )
load(here::here("data", "temporal_fd_kelp_biomass.RData") )
# loading thermal affinity data
thermal <- read.csv(here::here("data", "raw_data", "thermal_all.csv")) %>%
mutate(thermal_label= if_else(thermal>"23", "tropical", "temperate")) %>%
select(-thermal)
sp_3D_coord_bg <- sp_3D_coord #This one is just for the background polygon
# First, shorten species names
sp_3D_coord <- sp_3D_coord %>%
as.data.frame() %>%
rownames_to_column("Species_2") %>%
mutate(genus=sub("_.*", "", Species_2), sp=sub(".*_", "", Species_2)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
select(-genus, -sp, -Species_2) %>%
column_to_rownames("Species")
sp_3D_coord <- as.matrix(sp_3D_coord)
spatial_sp_biom <- spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to="species", values_to="count") %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
select(-genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from=count) %>%
column_to_rownames("Site")
spatial_sp_biom <- spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to="species", values_to="count") %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from=count) %>%
column_to_rownames("Site")
View(spatial_sp_biom)
View(kelp_sp_maxN)
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "Species", values_to = "Biomass")
################################################################################
##
## Script for preparing fish occurrence datasets and for computing species positions
## in a multidimensional space according to their trait values
##
## Code by Camille Magneville, Sebastien villeger and Paula Sgarlatta
##
################################################################################
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(mFD)
library(dplyr)
######### Preparing data #############
## temporal survey data ####
# loading raw data from csv----
# metadata and data from sites that use to have kelp and lost it:
kelp_metadata <- read.csv(here::here("data", "raw_data", "TemporalBRUV_kelp_metadata.csv") )
unique(kelp_metadata$Site) # 5 sites
unique(kelp_metadata$Year) # 14 years
kelp_sp_maxN <- read.csv(here::here("data", "raw_data", "TemporalBRUV_kelp_species.csv") ) %>%
column_to_rownames("Code") %>%
as.matrix()
# summary of surveys and occurrences data ----
kelp_summary <- mFD::asb.sp.summary(asb_sp_w = kelp_sp_maxN)
# retrieve occurrence matrix:
kelp_sp_occ <- kelp_summary$asb_sp_occ
# dimensions
dim(kelp_sp_occ) # 69 assemblages * 101 species
# names of species
kelp_sp <- colnames(kelp_sp_occ)
length(kelp_sp) # 101 sp
## This is to make a graph later
kelp_sp_data <- kelp_sp %>%
as.data.frame() %>%
rename(Species = ".") %>%
mutate(data_1 = "temporal")
#=> temporal data ready ####
## spatial survey data ####
# metadata of surveys and fish biomass (average across UVC transects) ----
spatial_metadata <- read.csv(here::here("data", "raw_data",  "SpatialUVC_metadata_site.csv"))
head(spatial_metadata)
spatial_sp_biom <- read.csv(here::here("data", "raw_data", "SpatialUVC_species_biomass_site_average.csv")) %>%
column_to_rownames("Code") %>%
as.matrix()
dim(spatial_sp_biom) # 9 assemblages * 53 species
# summary of surveys and occurrences data ----
spatial_summary <- mFD::asb.sp.summary(asb_sp_w = spatial_sp_biom)
# retrieve occurrence matrix:
spatial_sp_occ <- as.data.frame(spatial_summary$asb_sp_occ)
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "Species", values_to = "Biomass")
View(spatial_biomass)
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "Species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site))
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "Species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
dplyr::select(-Site)
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "Species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
dplyr::select(-Site) %>%
pivot_wider(names_from = Species, values_from = Biomass)
################################################################################
##
## Script for plotting changes in the multidimensional functional space across
## habitats and over years in a multidimensional space
##
##  * changes in space and time (only 2002, 2009 and 2018) - Figure 4
##
##  * changes in time (all years) - Figure S7
##
##
## Code by Paula Sgarlatta, Camille Magneville and Sebastien Villeger
##
################################################################################
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(dplyr)
library(here)
library(patchwork)
library(mFD)
library(ggpubr)
library(fishualize)
# loading data
load(here::here("data", "sp_3D_coord.RData") )
load(here::here("data", "spatial_metadata.RData") )
load(here::here("data", "spatial_sp_biom.RData") )
load(here::here("data", "spatial_fd_biomass.RData") )
load(here::here("data", "kelp_metadata.RData") )
load(here::here("data", "kelp_sp_maxN.RData") )
load(here::here("data", "temporal_fd_kelp_biomass.RData") )
# loading thermal affinity data
thermal <- read.csv(here::here("data", "raw_data", "thermal_all.csv")) %>%
mutate(thermal_label= if_else(thermal>"23", "tropical", "temperate")) %>%
select(-thermal)
sp_3D_coord_bg <- sp_3D_coord #This one is just for the background polygon
# First, shorten species names
sp_3D_coord <- sp_3D_coord %>%
as.data.frame() %>%
rownames_to_column("Species_2") %>%
mutate(genus=sub("_.*", "", Species_2), sp=sub(".*_", "", Species_2)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
select(-genus, -sp, -Species_2) %>%
column_to_rownames("Species")
sp_3D_coord <- as.matrix(sp_3D_coord)
spatial_sp_biom <- spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to="species", values_to="count") %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from=count) %>%
column_to_rownames("Site")
kelp_sp_maxN <- kelp_sp_maxN %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to="species", values_to="count") %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
select(-genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from=count) %>%
column_to_rownames("Site")
kelp_sp_maxN <- kelp_sp_maxN %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to="species", values_to="count") %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from=count) %>%
column_to_rownames("Site")
kelp_sp_maxN <- kelp_sp_maxN %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to="species", values_to="count")
View(kelp_sp_maxN)
kelp_sp_maxN <- kelp_sp_maxN %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to="species", values_to="count") %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species))
load(here::here("data", "kelp_sp_maxN.RData") )
kelp_sp_maxN_1 <- kelp_sp_maxN %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to="species", values_to="count") %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". "))
View(kelp_sp_maxN_1)
kelp_sp_maxN_1 <- kelp_sp_maxN %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to="species", values_to="count") %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-genus, -sp, -species)
kelp_sp_maxN_1 <- kelp_sp_maxN %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to="species", values_to="count") %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from=count)
################################################################################
##
## Script for preparing fish occurrence datasets and for computing species positions
## in a multidimensional space according to their trait values
##
## Code by Camille Magneville, Sebastien villeger and Paula Sgarlatta
##
################################################################################
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(mFD)
library(dplyr)
######### Preparing data #############
## temporal survey data ####
# loading raw data from csv----
# metadata and data from sites that use to have kelp and lost it:
kelp_metadata <- read.csv(here::here("data", "raw_data", "TemporalBRUV_kelp_metadata.csv") )
unique(kelp_metadata$Site) # 5 sites
unique(kelp_metadata$Year) # 14 years
kelp_sp_maxN <- read.csv(here::here("data", "raw_data", "TemporalBRUV_kelp_species.csv") ) %>%
column_to_rownames("Code") %>%
as.matrix()
# summary of surveys and occurrences data ----
kelp_summary <- mFD::asb.sp.summary(asb_sp_w = kelp_sp_maxN)
# retrieve occurrence matrix:
kelp_sp_occ <- kelp_summary$asb_sp_occ
# dimensions
dim(kelp_sp_occ) # 69 assemblages * 101 species
# names of species
kelp_sp <- colnames(kelp_sp_occ)
length(kelp_sp) # 101 sp
## This is to make a graph later
kelp_sp_data <- kelp_sp %>%
as.data.frame() %>%
rename(Species = ".") %>%
mutate(data_1 = "temporal")
#=> temporal data ready ####
## spatial survey data ####
# metadata of surveys and fish biomass (average across UVC transects) ----
spatial_metadata <- read.csv(here::here("data", "raw_data",  "SpatialUVC_metadata_site.csv"))
head(spatial_metadata)
spatial_sp_biom <- read.csv(here::here("data", "raw_data", "SpatialUVC_species_biomass_site_average.csv")) %>%
column_to_rownames("Code") %>%
as.matrix()
dim(spatial_sp_biom) # 9 assemblages * 53 species
# summary of surveys and occurrences data ----
spatial_summary <- mFD::asb.sp.summary(asb_sp_w = spatial_sp_biom)
# retrieve occurrence matrix:
spatial_sp_occ <- as.data.frame(spatial_summary$asb_sp_occ)
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-Site, -genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from = Biomass)
kelp_sp_maxN <- kelp_sp_maxN %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to="species", values_to="count") %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". "))
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-Site, -genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from = Biomass)
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species))
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". "))
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-Site, -genus, -sp, -species)
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-Site, -genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from = Biomass)
################################################################################
##
## Script for preparing fish occurrence datasets and for computing species positions
## in a multidimensional space according to their trait values
##
## Code by Camille Magneville, Sebastien villeger and Paula Sgarlatta
##
################################################################################
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(mFD)
library(dplyr)
######### Preparing data #############
## temporal survey data ####
# loading raw data from csv----
# metadata and data from sites that use to have kelp and lost it:
kelp_metadata <- read.csv(here::here("data", "raw_data", "TemporalBRUV_kelp_metadata.csv") )
unique(kelp_metadata$Site) # 5 sites
unique(kelp_metadata$Year) # 14 years
kelp_sp_maxN <- read.csv(here::here("data", "raw_data", "TemporalBRUV_kelp_species.csv") ) %>%
column_to_rownames("Code") %>%
as.matrix()
# summary of surveys and occurrences data ----
kelp_summary <- mFD::asb.sp.summary(asb_sp_w = kelp_sp_maxN)
# retrieve occurrence matrix:
kelp_sp_occ <- kelp_summary$asb_sp_occ
# dimensions
dim(kelp_sp_occ) # 69 assemblages * 101 species
# names of species
kelp_sp <- colnames(kelp_sp_occ)
length(kelp_sp) # 101 sp
## This is to make a graph later
kelp_sp_data <- kelp_sp %>%
as.data.frame() %>%
rename(Species = ".") %>%
mutate(data_1 = "temporal")
#=> temporal data ready ####
## spatial survey data ####
# metadata of surveys and fish biomass (average across UVC transects) ----
spatial_metadata <- read.csv(here::here("data", "raw_data",  "SpatialUVC_metadata_site.csv"))
head(spatial_metadata)
spatial_sp_biom <- read.csv(here::here("data", "raw_data", "SpatialUVC_species_biomass_site_average.csv")) %>%
column_to_rownames("Code") %>%
as.matrix()
dim(spatial_sp_biom) # 9 assemblages * 53 species
# summary of surveys and occurrences data ----
spatial_summary <- mFD::asb.sp.summary(asb_sp_w = spatial_sp_biom)
# retrieve occurrence matrix:
spatial_sp_occ <- as.data.frame(spatial_summary$asb_sp_occ)
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-Site, -genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from = Biomass)
values_fn(list)
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-Site, -genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from = Biomass, values_fn(list))
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-Site, -genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from = Biomass, values_fn=list)
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-Site, -genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from = Biomass, values_fn=NULL)
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-Site, -genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from = Biomass, values_fn=length)
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-Site, -genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from = Biomass, values_fn={summary_fun})
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-Site, -genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from = Biomass, values_fn=summary())
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-Site, -genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from = Biomass, values_fn=summary)
spatial_biomass <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-Site, -genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from = Biomass, values_fn= sum)
spatial_biomass_sp <-  spatial_sp_biom %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Habitat=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-Site, -genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from = Biomass, values_fn= sum)
write.csv(spatial_biomass_sp, file=here::here("data", "spatial_biomass_sp.csv"),
row.names = FALSE )
temporal_maxn_sp <-  kelp_sp_maxN
View(temporal_maxn_sp)
temporal_maxn_sp <-  kelp_sp_maxN %>%
as.data.frame() %>%
rownames_to_column("Site") %>%
pivot_longer(!Site, names_to = "species", values_to = "Biomass")%>%
mutate(Year=sub(".*_", "", Site)) %>%
mutate(genus=sub("_.*", "", species), sp=sub(".*_", "", species)) %>%
mutate(Species=paste(substr(genus, 1, 1), sp, sep = ". ")) %>%
dplyr::select(-Site, -genus, -sp, -species) %>%
pivot_wider(names_from = Species, values_from = Biomass, values_fn= sum)
write.csv(temporal_maxn_sp, file=here::here("data", "temporal_maxn_sp.csv"),
row.names = FALSE )
