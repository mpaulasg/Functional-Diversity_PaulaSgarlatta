scale_x_continuous( limits = c(2002, 2018), breaks = seq(from=2002, to=2018, by=4)  ) +
scale_y_continuous( limits = c(0.3,0.8), breaks = seq(from=0, to=1, by=0.2)  ) +
scale_color_manual(values=year_colors, name="Habitat", breaks = c("kelp", "no_kelp"), labels=c("Kelp", "No kelp")) +
scale_fill_manual(values=year_colors, name="Habitat", breaks = c("kelp", "no_kelp"), labels=c("Kelp", "No kelp")) +
labs(x="", y="Functional richness") +
theme(panel.background=element_rect(fill="white"), panel.grid.minor = element_blank(), axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),axis.line = element_line(size = 1, colour = "black"),
axis.text = element_text(size = (14),colour = "black"), axis.title = element_text(size= (16)),
legend.title = element_text(size=14), legend.text = element_text(size=14),
legend.background = element_blank(), legend.key=element_blank())
plot_tempo_func
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(dendextend)
library(patchwork)
# loading data
load(here::here("data", "spatial_metadata.RData") )
load(here::here("outputs/", "spatial_beta.RData") )
load(here::here("data", "kelp_metadata.RData") )
load(here::here("data", "nokelp_metadata.RData") )
load(here::here("outputs/", "temporal_beta_kelp.RData") )
load(here::here("outputs/", "temporal_beta_nokelp.RData") )
# values between assemblages from 2002 and later in kelp habitat ----
kelp_interyear_taxo_diss <- dendextend::dist_long(temporal_beta_kelp$taxo_diss) %>%
left_join( select(kelp_metadata, Code, Year1=Year), by=c("rows"="Code" ) ) %>%
left_join( select(kelp_metadata, Code, Year2=Year), by=c("cols"="Code" ) ) %>%
filter(Year1==2002 | Year2==2002) %>%
mutate(Year = pmax ( Year1, Year2 ) ) %>%
select(Year, taxo_diss = distance )  %>%
group_by(Year) %>%
summarise( n = n(),
taxo_diss_mean = mean(taxo_diss),
taxo_diss_sd = sd(taxo_diss)
) %>%
mutate( taxo_diss_se = taxo_diss_sd/sqrt(n)) %>%
mutate( Habitat = "Kelp", .before="Year" )
# values between assemblages from 2002 and later in no kelp habitat ----
nokelp_interyear_taxo_diss <- dendextend::dist_long(temporal_beta_nokelp$taxo_diss) %>%
left_join( select(nokelp_metadata, Code, Year1=Year), by=c("rows"="Code" ) ) %>%
left_join( select(nokelp_metadata, Code, Year2=Year), by=c("cols"="Code" ) ) %>%
filter(Year1==2002 | Year2==2002) %>%
mutate(Year = pmax ( Year1, Year2 ) ) %>%
select(Year, taxo_diss = distance )  %>%
group_by(Year) %>%
summarise( n = n(),
taxo_diss_mean = mean(taxo_diss),
taxo_diss_sd = sd(taxo_diss)
) %>%
mutate( taxo_diss_se = taxo_diss_sd/sqrt(n)) %>%
mutate( Habitat = "No_Kelp", .before="Year" )
# adding dissimilarity between the 3 habitats (from 2013) ----
interhab_taxo_diss <- dendextend::dist_long(spatial_beta$taxo_diss) %>%
left_join( select(spatial_metadata, Code, Habitat1=Habitat), by=c("rows"="Code" ) ) %>%
left_join( select(spatial_metadata, Code, Habitat2=Habitat), by=c("cols"="Code" ) ) %>%
select(Habitat1, Habitat2, taxo_diss = distance )
spatial_diss <- interhab_taxo_diss %>%
group_by(Habitat1, Habitat2) %>%
summarise( n = n(),
taxo_diss_mean = mean(taxo_diss),
taxo_diss_sd = sd(taxo_diss)
) %>%
ungroup(Habitat1, Habitat2) %>%
mutate( taxo_diss_se = taxo_diss_sd/sqrt(n)) %>%
mutate( Habitat = paste(Habitat1, Habitat2, sep="_"), .before="Habitat1" ) %>%
select(-Habitat1, -Habitat2) %>%
mutate( Year = 2013, .before="Year" ) %>%
filter(Habitat %in%c("Midshelf_Inshore", "Offshore_Midshelf", "Offshore_Inshore") ) %>%
droplevels("Habitat")
# merging ----
taxo_dissim_toplot <- bind_rows(kelp_interyear_taxo_diss,
nokelp_interyear_taxo_diss,
spatial_diss)
head(taxo_dissim_toplot)
# color code for the 3 habitats
hab_colors <- c(Kelp="seagreen4", No_Kelp="seagreen2",
Midshelf_Inshore="mediumseagreen", Offshore_Midshelf="lightsalmon1", Offshore_Inshore="firebrick3")
hab_shape <- c(Kelp=21, No_Kelp=21,
Midshelf_Inshore=22, Offshore_Midshelf=22, Offshore_Inshore=22)
plot_dissim_taxo <- ggplot(taxo_dissim_toplot, mapping = aes(color=Habitat, fill=Habitat)) +
geom_point(aes(x=Year, y=taxo_diss_mean,
shape= Habitat), stat="identity", size=3) +
geom_errorbar( aes(x=Year, ymin=taxo_diss_mean-taxo_diss_se, ymax=taxo_diss_mean+taxo_diss_se),
width=0.2, size=0.5 ) +
scale_color_manual(values=hab_colors) +
scale_fill_manual(values=hab_colors) +
scale_shape_manual(values=hab_shape) +
scale_x_continuous( limits = c(2002, 2018), breaks = seq(from=2002, to=2018, by=4)  ) +
scale_y_continuous( limits = c(0.4,0.9), breaks = seq(from=0, to=1, by=0.2)  ) +
labs(x="", y="Species dissimilarity") +
theme(panel.background=element_rect(fill="white"), panel.grid.minor = element_blank(), axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),axis.line = element_line(size = 1, colour = "black"),
axis.text = element_text(size = (12),colour = "black"), axis.title = element_text(size= (14)),
legend.position = "none")
plot_dissim_taxo
# values between assemblages from 2002 and later in kelp habitat ----
kelp_interyear_func_diss <- dendextend::dist_long(temporal_beta_kelp$func_diss) %>%
left_join( select(kelp_metadata, Code, Year1=Year), by=c("rows"="Code" ) ) %>%
left_join( select(kelp_metadata, Code, Year2=Year), by=c("cols"="Code" ) ) %>%
filter(Year1==2002 | Year2==2002) %>%
mutate(Year = pmax ( Year1, Year2 ) ) %>%
select(Year, func_diss = distance )  %>%
group_by(Year) %>%
summarise( n = n(),
func_diss_mean = mean(func_diss),
func_diss_sd = sd(func_diss)
) %>%
mutate( func_diss_se = func_diss_sd/sqrt(n)) %>%
mutate( Habitat = "Kelp", .before="Year" )
# values between assemblages from 2002 and later in no kelp habitat ----
nokelp_interyear_func_diss <- dendextend::dist_long(temporal_beta_nokelp$func_diss) %>%
left_join( select(nokelp_metadata, Code, Year1=Year), by=c("rows"="Code" ) ) %>%
left_join( select(nokelp_metadata, Code, Year2=Year), by=c("cols"="Code" ) ) %>%
filter(Year1==2002 | Year2==2002) %>%
mutate(Year = pmax ( Year1, Year2 ) ) %>%
select(Year, func_diss = distance )  %>%
group_by(Year) %>%
summarise( n = n(),
func_diss_mean = mean(func_diss),
func_diss_sd = sd(func_diss)
) %>%
mutate( func_diss_se = func_diss_sd/sqrt(n)) %>%
mutate( Habitat = "No_Kelp", .before="Year" )
# adding dissimilarity between the 3 habitats (from 2013) ----
interhab_func_diss <- dendextend::dist_long(spatial_beta$func_diss) %>%
left_join( select(spatial_metadata, Code, Habitat1=Habitat), by=c("rows"="Code" ) ) %>%
left_join( select(spatial_metadata, Code, Habitat2=Habitat), by=c("cols"="Code" ) ) %>%
select(Habitat1, Habitat2, func_diss = distance )
spatial_diss <- interhab_func_diss %>%
group_by(Habitat1, Habitat2) %>%
summarise( n = n(),
func_diss_mean = mean(func_diss),
func_diss_sd = sd(func_diss)
) %>%
ungroup(Habitat1, Habitat2) %>%
mutate( func_diss_se = func_diss_sd/sqrt(n)) %>%
mutate( Habitat = paste(Habitat1, Habitat2, sep="_"), .before="Habitat1" ) %>%
select(-Habitat1, -Habitat2) %>%
mutate( Year = 2013, .before="Year" ) %>%
filter(Habitat %in%c("Midshelf_Inshore", "Offshore_Midshelf", "Offshore_Inshore") ) %>%
droplevels("Habitat")
# merging ----
func_dissim_toplot <- bind_rows(kelp_interyear_func_diss,
nokelp_interyear_func_diss,
spatial_diss)
head(func_dissim_toplot)
plot_dissim_func <- ggplot(func_dissim_toplot, mapping =aes(color=Habitat, fill=Habitat) ) +
geom_point( aes(x=Year, y=func_diss_mean,
shape= Habitat), stat="identity", size=3) +
geom_errorbar( aes(x=Year, ymin=func_diss_mean-func_diss_se, ymax=func_diss_mean+func_diss_se),
width=0.2, size=0.5 ) +
scale_color_manual(values=hab_colors) +
scale_fill_manual(values=hab_colors) +
scale_shape_manual(values=hab_shape) +
scale_x_continuous( limits = c(2002, 2018), breaks = seq(from=2002, to=2018, by=4)  ) +
scale_y_continuous( limits = c(0.2,0.7), breaks = seq(from=0, to=1, by=0.2)  ) +
labs(x="", y="Functional dissimilarity") +
theme(panel.background=element_rect(fill="white"), panel.grid.minor = element_blank(), axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),axis.line = element_line(size = 1, colour = "black"),
axis.text = element_text(size = (12),colour = "black"), axis.title = element_text(size= (14)),
legend.title = element_text(size=12), legend.text = element_text(size=12),
legend.background = element_blank(), legend.key=element_blank())
plot_dissim_func
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(dendextend)
library(patchwork)
# loading data
load(here::here("data", "spatial_metadata.RData") )
load(here::here("outputs/", "spatial_beta.RData") )
load(here::here("data", "kelp_metadata.RData") )
load(here::here("data", "nokelp_metadata.RData") )
load(here::here("outputs/", "temporal_beta_kelp.RData") )
load(here::here("outputs/", "temporal_beta_nokelp.RData") )
# values between assemblages from 2002 and later in kelp habitat ----
kelp_interyear_taxo_diss <- dendextend::dist_long(temporal_beta_kelp$taxo_diss) %>%
left_join( select(kelp_metadata, Code, Site1=Site, Year1=Year), by=c("rows"="Code" ) ) %>%
left_join( select(kelp_metadata, Code, Site2=Site, Year2=Year), by=c("cols"="Code" ) ) %>%
filter(Year1==2002 | Year2==2002) %>%
filter(Site1 == Site2) %>%
mutate(Year = pmax ( Year1, Year2 ) ) %>%
mutate(Site = Site1 ) %>%
select(Year, Site, taxo_diss = distance )  %>%
mutate( Habitat = "Kelp", .before="Year" )
# values between assemblages from 2002 and later in no kelp habitat ----
nokelp_interyear_taxo_diss <- dendextend::dist_long(temporal_beta_nokelp$taxo_diss) %>%
left_join( select(nokelp_metadata, Code, Site1=Site, Year1=Year), by=c("rows"="Code" ) ) %>%
left_join( select(nokelp_metadata, Code, Site2=Site, Year2=Year), by=c("cols"="Code" ) ) %>%
filter(Year1==2002 | Year2==2002) %>%
filter(Site1 == Site2) %>%
mutate(Year = pmax ( Year1, Year2 ) ) %>%
mutate(Site = Site1 ) %>%
select(Year, Site, taxo_diss = distance )  %>%
mutate( Habitat = "No_Kelp", .before="Year" )
# adding dissimilarity between the 3 habitats (from 2013) ----
interhab_taxo_diss <- dendextend::dist_long(spatial_beta$taxo_diss) %>%
left_join( select(spatial_metadata, Code, Habitat1=Habitat), by=c("rows"="Code" ) ) %>%
left_join( select(spatial_metadata, Code, Habitat2=Habitat), by=c("cols"="Code" ) ) %>%
select(Habitat1, Habitat2, taxo_diss = distance )
spatial_diss <- interhab_taxo_diss %>%
group_by(Habitat1, Habitat2) %>%
summarise(taxo_diss = mean(taxo_diss) ) %>%
ungroup(Habitat1, Habitat2) %>%
mutate( Habitat = paste(Habitat1, Habitat2, sep="_"), .before="Habitat1" ) %>%
select(-Habitat1, -Habitat2) %>%
mutate( Year = 2013, .before="Year" ) %>%
filter(Habitat %in%c("Midshelf_Inshore", "Offshore_Midshelf", "Offshore_Inshore") ) %>%
droplevels("Habitat")
# merging ----
taxo_dissim_toplot <- bind_rows(kelp_interyear_taxo_diss,
nokelp_interyear_taxo_diss,
spatial_diss)
head(taxo_dissim_toplot)
# color code for the 3 habitats
hab_colors <- c(Kelp="seagreen4", No_Kelp="seagreen2",
Midshelf_Inshore="mediumseagreen", Offshore_Midshelf="lightsalmon1", Offshore_Inshore="firebrick3")
hab_shape <- c(Kelp=21, No_Kelp=21,
Midshelf_Inshore=22, Offshore_Midshelf=22, Offshore_Inshore=22)
plot_dissim_taxo <- ggplot(taxo_dissim_toplot, aes(x=Year, y=taxo_diss, group=Site) ) +
geom_point( aes( shape= Habitat, color = Habitat, fill = Habitat), stat="identity") +
geom_line( aes(color = Habitat), size=0.5 ) +
scale_color_manual(values=hab_colors) +
scale_fill_manual(values=hab_colors) +
scale_shape_manual(values=hab_shape) +
scale_x_continuous( limits = c(2002, 2018), breaks = seq(from=2002, to=2018, by=4)  ) +
scale_y_continuous( limits = c(0.2,1), breaks = seq(from=0, to=1, by=0.2)  ) +
labs(x="", y="Species dissimilarity") +
theme(panel.background=element_rect(fill="white"), panel.grid.minor = element_blank(), axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),axis.line = element_line(size = 1, colour = "black"),
axis.text = element_text(size = (12),colour = "black"), axis.title = element_text(size= (14)),
legend.position = "none")
plot_dissim_taxo
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(dendextend)
library(patchwork)
# loading data
load(here::here("data", "spatial_metadata.RData") )
load(here::here("outputs/", "spatial_beta.RData") )
load(here::here("data", "kelp_metadata.RData") )
load(here::here("data", "nokelp_metadata.RData") )
load(here::here("outputs/", "temporal_beta_kelp.RData") )
load(here::here("outputs/", "temporal_beta_nokelp.RData") )
# values between assemblages from 2002 and later in kelp habitat ----
kelp_interyear_taxo_turn <- dendextend::dist_long(temporal_beta_kelp$taxo_turn) %>%
left_join( select(kelp_metadata, Code, Year1=Year), by=c("rows"="Code" ) ) %>%
left_join( select(kelp_metadata, Code, Year2=Year), by=c("cols"="Code" ) ) %>%
filter(Year1==2002 | Year2==2002) %>%
mutate(Year = pmax ( Year1, Year2 ) ) %>%
select(Year, taxo_turn = distance )  %>%
group_by(Year) %>%
summarise( n = n(),
taxo_turn_mean = mean(taxo_turn),
taxo_turn_sd = sd(taxo_turn)
) %>%
mutate( taxo_turn_se = taxo_turn_sd/sqrt(n)) %>%
mutate( Habitat = "Kelp", .before="Year" )
# values between assemblages from 2002 and later in no kelp habitat ----
nokelp_interyear_taxo_turn <- dendextend::dist_long(temporal_beta_nokelp$taxo_turn) %>%
left_join( select(nokelp_metadata, Code, Year1=Year), by=c("rows"="Code" ) ) %>%
left_join( select(nokelp_metadata, Code, Year2=Year), by=c("cols"="Code" ) ) %>%
filter(Year1==2002 | Year2==2002) %>%
mutate(Year = pmax ( Year1, Year2 ) ) %>%
select(Year, taxo_turn = distance )  %>%
group_by(Year) %>%
summarise( n = n(),
taxo_turn_mean = mean(taxo_turn),
taxo_turn_sd = sd(taxo_turn)
) %>%
mutate( taxo_turn_se = taxo_turn_sd/sqrt(n)) %>%
mutate( Habitat = "No_Kelp", .before="Year" )
# adding turnover between the 3 habitats (from 2013) ----
interhab_taxo_turn <- dendextend::dist_long(spatial_beta$taxo_turn) %>%
left_join( select(spatial_metadata, Code, Habitat1=Habitat), by=c("rows"="Code" ) ) %>%
left_join( select(spatial_metadata, Code, Habitat2=Habitat), by=c("cols"="Code" ) ) %>%
select(Habitat1, Habitat2, taxo_turn = distance )
spatial_turn <- interhab_taxo_turn %>%
group_by(Habitat1, Habitat2) %>%
summarise( n = n(),
taxo_turn_mean = mean(taxo_turn),
taxo_turn_sd = sd(taxo_turn)
) %>%
ungroup(Habitat1, Habitat2) %>%
mutate( taxo_turn_se = taxo_turn_sd/sqrt(n)) %>%
mutate( Habitat = paste(Habitat1, Habitat2, sep="_"), .before="Habitat1" ) %>%
select(-Habitat1, -Habitat2) %>%
mutate( Year = 2013, .before="Year" ) %>%
filter(Habitat %in%c("Midshelf_Inshore", "Offshore_Midshelf", "Offshore_Inshore") ) %>%
droplevels("Habitat")
# merging ----
taxo_turnim_toplot <- bind_rows(kelp_interyear_taxo_turn,
nokelp_interyear_taxo_turn,
spatial_turn)
head(taxo_turnim_toplot)
# color code for the 3 habitats
hab_colors <- c(Kelp="seagreen4", No_Kelp="seagreen2",
Midshelf_Inshore="mediumseagreen", Offshore_Midshelf="lightsalmon1", Offshore_Inshore="firebrick3")
hab_shape <- c(Kelp=21, No_Kelp=21,
Midshelf_Inshore=22, Offshore_Midshelf=22, Offshore_Inshore=22)
plot_turnim_taxo <- ggplot(taxo_turnim_toplot, mapping = aes(color=Habitat, fill=Habitat)) +
geom_point( aes(x=Year, y=taxo_turn_mean,
shape= Habitat), stat="identity") +
geom_errorbar( aes(x=Year, ymin=taxo_turn_mean-taxo_turn_se, ymax=taxo_turn_mean+taxo_turn_se),
width=0.2, size=0.5 ) +
scale_color_manual(values=hab_colors) +
scale_fill_manual(values=hab_colors) +
scale_shape_manual(values=hab_shape) +
scale_x_continuous( limits = c(2002, 2018), breaks = seq(from=2002, to=2018, by=4)  ) +
scale_y_continuous( limits = c(0.3,0.8), breaks = seq(from=0, to=1, by=0.2)  ) +
labs(x="", y="Species turnover") +
theme(panel.background=element_rect(fill="white"), panel.grid.minor = element_blank(), axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),axis.line = element_line(size = 1, colour = "black"),
axis.text = element_text(size = (12),colour = "black"), axis.title = element_text(size= (14)),
legend.position = "none")
plot_turnim_taxo
# values between assemblages from 2002 and later in kelp habitat ----
kelp_interyear_func_turn <- dendextend::dist_long(temporal_beta_kelp$func_turn) %>%
left_join( select(kelp_metadata, Code, Year1=Year), by=c("rows"="Code" ) ) %>%
left_join( select(kelp_metadata, Code, Year2=Year), by=c("cols"="Code" ) ) %>%
filter(Year1==2002 | Year2==2002) %>%
mutate(Year = pmax ( Year1, Year2 ) ) %>%
select(Year, func_turn = distance )  %>%
group_by(Year) %>%
summarise( n = n(),
func_turn_mean = mean(func_turn),
func_turn_sd = sd(func_turn)
) %>%
mutate( func_turn_se = func_turn_sd/sqrt(n)) %>%
mutate( Habitat = "Kelp", .before="Year" )
# values between assemblages from 2002 and later in no kelp habitat ----
nokelp_interyear_func_turn <- dendextend::dist_long(temporal_beta_nokelp$func_turn) %>%
left_join( select(nokelp_metadata, Code, Year1=Year), by=c("rows"="Code" ) ) %>%
left_join( select(nokelp_metadata, Code, Year2=Year), by=c("cols"="Code" ) ) %>%
filter(Year1==2002 | Year2==2002) %>%
mutate(Year = pmax ( Year1, Year2 ) ) %>%
select(Year, func_turn = distance )  %>%
group_by(Year) %>%
summarise( n = n(),
func_turn_mean = mean(func_turn),
func_turn_sd = sd(func_turn)
) %>%
mutate( func_turn_se = func_turn_sd/sqrt(n)) %>%
mutate( Habitat = "No_Kelp", .before="Year" )
# adding turnover between the 3 habitats (from 2013) ----
interhab_func_turn <- dendextend::dist_long(spatial_beta$func_turn) %>%
left_join( select(spatial_metadata, Code, Habitat1=Habitat), by=c("rows"="Code" ) ) %>%
left_join( select(spatial_metadata, Code, Habitat2=Habitat), by=c("cols"="Code" ) ) %>%
select(Habitat1, Habitat2, func_turn = distance )
spatial_turn <- interhab_func_turn %>%
group_by(Habitat1, Habitat2) %>%
summarise( n = n(),
func_turn_mean = mean(func_turn),
func_turn_sd = sd(func_turn)
) %>%
ungroup(Habitat1, Habitat2) %>%
mutate( func_turn_se = func_turn_sd/sqrt(n)) %>%
mutate( Habitat = paste(Habitat1, Habitat2, sep="_"), .before="Habitat1" ) %>%
select(-Habitat1, -Habitat2) %>%
mutate( Year = 2013, .before="Year" ) %>%
filter(Habitat %in%c("Midshelf_Inshore", "Offshore_Midshelf", "Offshore_Inshore") ) %>%
droplevels("Habitat")
# merging ----
func_turnim_toplot <- bind_rows(kelp_interyear_func_turn,
nokelp_interyear_func_turn,
spatial_turn)
head(func_turnim_toplot)
plot_turnim_func <- ggplot(func_turnim_toplot, mapping = aes(color=Habitat, fill=Habitat)) +
geom_point( aes(x=Year, y=func_turn_mean,
shape= Habitat), stat="identity") +
geom_errorbar( aes(x=Year, ymin=func_turn_mean-func_turn_se, ymax=func_turn_mean+func_turn_se),
width=0.2, size=0.5) +
scale_color_manual(values=hab_colors) +
scale_fill_manual(values=hab_colors) +
scale_shape_manual(values=hab_shape) +
scale_x_continuous( limits = c(2002, 2018), breaks = seq(from=2002, to=2018, by=4)  ) +
scale_y_continuous( limits = c(0,0.6), breaks = seq(from=0, to=1, by=0.2)  ) +
labs(x="", y="Functional turnover") +
theme(panel.background=element_rect(fill="white"), panel.grid.minor = element_blank(), axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),axis.line = element_line(size = 1, colour = "black"),
axis.text = element_text(size = (12),colour = "black"), axis.title = element_text(size= (14)),
legend.title = element_text(size=12), legend.text = element_text(size=12),
legend.background = element_blank(), legend.key=element_blank())
plot_turnim_func
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(patchwork)
library(mFD)
# loading data
load(here::here("outputs", "sp_3D_coord.RData") )
load(here::here("data", "spatial_metadata.RData") )
load(here::here("data", "spatial_sp_occ.RData") )
load(here::here("outputs/", "spatial_fd.RData") )
load(here::here("data", "kelp_metadata.RData") )
load(here::here("data", "kelp_sp_occ.RData") )
load(here::here("data", "nokelp_metadata.RData") )
load(here::here("data", "nokelp_sp_occ.RData") )
# coordinates of all species ----
pool_coord<-spatial_fd$details$sp_faxes_coord
# vertices of all fe in 4D ----
pool_vert_nm<-spatial_fd$details$pool_vert_nm
# range of axes
range_faxes_coord <- range(pool_coord[,1:3])
range_axes <- range_faxes_coord +
c(-1, 1) * (range_faxes_coord[2] - range_faxes_coord[1]) * 0.1
names(spatial_fd$details$asb_vert_nm)
spatial_metadata
# computing occurrences of species in each habitat
kelp_years_sp_occ <- rbind(
y2002 = apply(kelp_sp_occ [kelp_metadata[which(kelp_metadata$Year=="2002"),"Code"],],2,max ),
y2008 = apply(kelp_sp_occ [kelp_metadata[which(kelp_metadata$Year=="2008"),"Code"],],2,max ),
y2013 = apply(kelp_sp_occ [kelp_metadata[which(kelp_metadata$Year=="2013"),"Code"],],2,max ),
y2018 = apply(kelp_sp_occ [kelp_metadata[which(kelp_metadata$Year=="2018"),"Code"],],2,max )
)
# compute FRic for all habitats  ---
kelp_years_multidimFD<-alpha.fd.multidim(sp_faxes_coord = sp_3D_coord,
asb_sp_w = kelp_years_sp_occ,
ind_vect = c("fric"),
scaling = TRUE,
details_returned = TRUE
)
# color code for the 4 years
years_colors <- c(y2002="green3", y2008="blue3", y2013="grey50", y2018="red3")
# list to store ggplot
ggplot_temporal_kelp<-list()
load(here::here("outputs", "sp_3D_coord_spatial.RData") )
# compute FRic for all habitats  ---
kelp_years_multidimFD<-alpha.fd.multidim(sp_faxes_coord = sp_3D_coord_kelp, #[PS] Original was sp_3D_coord
asb_sp_w = kelp_years_sp_occ,
ind_vect = c("fric"),
scaling = TRUE,
details_returned = TRUE
)
load(here::here("outputs", "sp_3D_coord_kelp.RData") ) #[PS] Adding these three
load(here::here("outputs", "sp_3D_coord_nokelp.RData") )
load(here::here("outputs", "sp_3D_coord_spatial.RData") )
# compute FRic for all habitats  ---
kelp_years_multidimFD<-alpha.fd.multidim(sp_faxes_coord = sp_3D_coord_kelp, #[PS] Original was sp_3D_coord
asb_sp_w = kelp_years_sp_occ,
ind_vect = c("fric"),
scaling = TRUE,
details_returned = TRUE
)
# color code for the 4 years
years_colors <- c(y2002="green3", y2008="blue3", y2013="grey50", y2018="red3")
# list to store ggplot
ggplot_temporal_kelp<-list()
# pairs of axes
pairs_axes<-list( c(1,2), c(1,3) )
for ( z in 1:length(pairs_axes) ) {
# names of axes
xy<-pairs_axes[[z]]
# background with axes range set + title
ggplot_z<-background.plot(range_faxes=range_axes,
faxes_nm=paste0("PC", xy),
color_bg="grey95")
# convex hull of species pool
ggplot_z<-pool.plot(ggplot_bg=ggplot_z,
sp_coord2D=pool_coord[,xy],
vertices_nD=pool_vert_nm,
plot_pool=FALSE,
color_ch=NA, fill_ch="white", alpha_ch=1)
# loop on years
for (h in row.names(kelp_years_sp_occ) ) {
# color given habitat
col_h<-as.character(years_colors[h])
# species present in v
sp_h<-names(which(kelp_years_multidimFD$details$asb_sp_occ[h,]==1))
# plot convex hull of assemblage but not species
ggplot_z<-fric.plot( ggplot_bg=ggplot_z,
asb_sp_coord2D=list(vv=pool_coord[sp_h,xy]),
asb_vertices_nD=list(vv=kelp_years_multidimFD$details$asb_vert_nm[[h]]),
plot_sp = FALSE,
color_ch=c(vv=col_h),
fill_ch=c(vv=col_h),
alpha_ch=c(vv=0.1)
)
}# end of h
if (z==1) {
nlabels_y <- length(years_colors)
ggplot_z <- ggplot_z +
geom_text(aes(x = rep(range_axes[1]*0.9, nlabels_y ),
y = range_axes[2]*(1.05-0.15*(1:nlabels_y)),
label = names(years_colors) ),
color = years_colors,
hjust = "left",
show.legend = FALSE) +
ggtitle("Temporal - Kelp")
}
# ggplot stored in list
ggplot_temporal_kelp[[z]]<-ggplot_z
}# end of z
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(dplyr)
kelp_sp <- read.csv(here::here("temporal_kelp_species.csv"),
header = T)
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(here)
library(dplyr)
kelp_sp <- read.csv(here::here("temporal_kelp_species.csv"),
header = T)
